# ğŸ¯ Diagrama de Arquitectura MFA

## 1. Estructura General del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APLICACIÃ“N NUAM                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   HOME       â”‚  â”‚   CUENTAS    â”‚  â”‚  DASHBOARD   â”‚      â”‚
â”‚  â”‚  (Landing)   â”‚  â”‚ (Auth + MFA) â”‚  â”‚  (Control)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              DJANGO FRAMEWORK                       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ Modelos (ORM)    â€¢ Vistas          â€¢ Templates   â”‚   â”‚
â”‚  â”‚ â€¢ AutenticaciÃ³n    â€¢ Sesiones        â€¢ Formularios â”‚   â”‚
â”‚  â”‚ â€¢ Email Backend    â€¢ Middleware                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         LIBRERÃAS EXTERNAS PARA MFA                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â€¢ pyotp â†’ GeneraciÃ³n de OTP/TOTP                  â”‚   â”‚
â”‚  â”‚ â€¢ qrcode â†’ GeneraciÃ³n de QR codes                 â”‚   â”‚
â”‚  â”‚ â€¢ django.core.mail â†’ EnvÃ­o de correos             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Flujo de Login sin MFA

```
Usuario                    Sistema                  BD
   â”‚                         â”‚                      â”‚
   â”œâ”€ Email + Password â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                         â”œâ”€ Buscar usuario â”€â”€â”€â”€>â”‚
   â”‚                         â”‚<â”€ Usuario encontradoâ”€â”¤
   â”‚                         â”‚                      â”‚
   â”‚                         â”œâ”€ check_password()   â”‚
   â”‚                         â”œâ”€ âœ… VÃ¡lido          â”‚
   â”‚                         â”‚                      â”‚
   â”‚                         â”œâ”€ mfa_enabled?       â”‚
   â”‚                         â”œâ”€ âŒ NO              â”‚
   â”‚                         â”‚                      â”‚
   â”‚                         â”œâ”€ login()            â”‚
   â”‚                         â”œâ”€ Crear sesiÃ³n â”€â”€â”€â”€â”€>â”‚
   â”‚<â”€ Redirect Dashboard â”€â”€â”€â”¤                     â”‚
   â”‚                         â”‚                     â”‚
```

---

## 3. Flujo de Login CON MFA Activado

```
Usuario                Sistema               BD                Email
   â”‚                     â”‚                   â”‚                  â”‚
   â”œâ”€ Email + Pass â”€â”€â”€â”€â”€>â”‚                   â”‚                  â”‚
   â”‚                     â”œâ”€ Validar â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
   â”‚                     â”‚<â”€ âœ… VÃ¡lido â”€â”€â”€â”¤                  â”‚
   â”‚                     â”‚                   â”‚                  â”‚
   â”‚                     â”œâ”€ mfa_enabled? â”€â”€â”€>â”‚                  â”‚
   â”‚                     â”‚<â”€ true â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
   â”‚                     â”‚                   â”‚                  â”‚
   â”‚                     â”œâ”€ generate_otp() â”€â”€>â”‚                â”‚
   â”‚                     â”‚<â”€ OTP (123456) â”€â”€â”€â”¤                â”‚
   â”‚                     â”‚                   â”‚                â”‚
   â”‚                     â”œâ”€ send_mail()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                     â”‚                   â”‚    Enviar OTP  â”‚
   â”‚                     â”‚                   â”‚                â”‚
   â”‚                     â”œâ”€ Guardar sesiÃ³n â”€â”€>â”‚                â”‚
   â”‚<â”€ Ir a verificar â”€â”€â”€â”¤                   â”‚                â”‚
   â”‚                     â”‚                   â”‚                â”‚
   â”‚ Recibe email âœ‰ï¸     â”‚                   â”‚                â”‚
   â”‚ Copia OTP           â”‚                   â”‚                â”‚
   â”‚                     â”‚                   â”‚                â”‚
   â”œâ”€ Ingresar OTP â”€â”€â”€â”€>â”‚                   â”‚                â”‚
   â”‚ "123456"            â”‚                   â”‚                â”‚
   â”‚                     â”œâ”€ verify_otp() â”€â”€â”€â”€>â”‚                â”‚
   â”‚                     â”œâ”€ Validar tiempo â”€â”€>â”‚                â”‚
   â”‚                     â”‚<â”€ âœ… OK â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
   â”‚                     â”‚                   â”‚                â”‚
   â”‚                     â”œâ”€ login() â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
   â”‚<â”€ Redirect Dash â”€â”€â”€â”€â”¤                   â”‚                â”‚
```

---

## 4. Flujo de HabilitaciÃ³n de MFA

```
Usuario              Sistema              BD              Auth App
   â”‚                   â”‚                  â”‚                â”‚
   â”œâ”€ Ir a Settings â”€â”€>â”‚                  â”‚                â”‚
   â”‚                   â”œâ”€ Mostrar pÃ¡gina â”€>â”‚                â”‚
   â”‚<â”€ Formulario â”€â”€â”€â”€â”€â”¤                  â”‚                â”‚
   â”‚                   â”‚                  â”‚                â”‚
   â”œâ”€ Click Habilitar >â”‚                  â”‚                â”‚
   â”‚                   â”œâ”€ generate_secret >â”‚                â”‚
   â”‚                   â”‚<â”€ Secreto â”€â”€â”€â”€â”€â”€â”¤                â”‚
   â”‚                   â”‚                  â”‚                â”‚
   â”‚                   â”œâ”€ get_totp_uri() â”€>â”‚                â”‚
   â”‚                   â”‚<â”€ URI + QR â”€â”€â”€â”€â”€â”¤                â”‚
   â”‚<â”€ Mostrar QR â”€â”€â”€â”€â”€â”¤                  â”‚                â”‚
   â”‚                   â”‚                  â”‚                â”‚
   â”œâ”€ Scan QR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ con Auth App      â”‚                  â”‚            Guardar
   â”‚                   â”‚                  â”‚            Secreto
   â”‚ Obtiene cÃ³digo    â”‚                  â”‚                â”‚
   â”‚ (TOTP)            â”‚                  â”‚                â”‚
   â”‚                   â”‚                  â”‚                â”‚
   â”œâ”€ Ingresa cÃ³digo â”€>â”‚                  â”‚                â”‚
   â”‚ "654321"          â”‚                  â”‚                â”‚
   â”‚                   â”œâ”€ verify_totp() â”€â”€>â”‚                â”‚
   â”‚                   â”‚<â”€ âœ… VÃ¡lido â”€â”€â”€â”€â”€â”¤                â”‚
   â”‚                   â”‚                  â”‚                â”‚
   â”‚                   â”œâ”€ mfa_enabled=True â”€>â”‚              â”‚
   â”‚                   â”‚                  â”‚ Guardar        â”‚
   â”‚<â”€ âœ… Habilitado â”€â”€â”¤                  â”‚                â”‚
```

---

## 5. Estructura de Datos - Modelo Usuario

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Usuario (Modelo Django)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  Campos BÃ¡sicos:                                â”‚
â”‚  â”œâ”€ id: Integer (PK)                           â”‚
â”‚  â”œâ”€ nombre: CharField(100)                     â”‚
â”‚  â”œâ”€ correo: EmailField (UNIQUE)                â”‚
â”‚  â”œâ”€ password: CharField(250) [hashed]          â”‚
â”‚  â”œâ”€ is_active: Boolean                         â”‚
â”‚  â”œâ”€ is_staff: Boolean                          â”‚
â”‚  â”‚                                             â”‚
â”‚  Campos MFA (NUEVOS):                           â”‚
â”‚  â”œâ”€ mfa_enabled: Boolean [default=False]       â”‚
â”‚  â”‚  â””â”€ Indica si MFA estÃ¡ activado             â”‚
â”‚  â”‚                                             â”‚
â”‚  â”œâ”€ mfa_secret: CharField(32) [nullable]       â”‚
â”‚  â”‚  â””â”€ Clave secreta para TOTP                 â”‚
â”‚  â”‚  â””â”€ Ejemplo: "JBSWY3DPEBLW64TMMQ======"   â”‚
â”‚  â”‚                                             â”‚
â”‚  â”œâ”€ otp_code: CharField(6) [nullable]          â”‚
â”‚  â”‚  â””â”€ CÃ³digo OTP actual (6 dÃ­gitos)           â”‚
â”‚  â”‚  â””â”€ Ejemplo: "451289"                       â”‚
â”‚  â”‚                                             â”‚
â”‚  â”œâ”€ otp_created_at: DateTimeField [nullable]   â”‚
â”‚  â”‚  â””â”€ Timestamp de creaciÃ³n del OTP           â”‚
â”‚  â”‚  â””â”€ Usado para calcular expiraciÃ³n          â”‚
â”‚  â”‚                                             â”‚
â”‚  â”œâ”€ backup_codes: TextField [nullable]         â”‚
â”‚  â”‚  â””â”€ CÃ³digos de respaldo (formato JSON)      â”‚
â”‚  â”‚  â””â”€ Para recuperaciÃ³n de cuenta             â”‚
â”‚  â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MÃ©todos MFA:
â”œâ”€ generate_otp() â†’ str (6 dÃ­gitos)
â”œâ”€ verify_otp(code) â†’ bool
â”œâ”€ get_totp_uri() â†’ str (URI para QR)
â””â”€ verify_totp(token) â†’ bool
```

---

## 6. Endpoints y Rutas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RUTAS DEL SISTEMA MFA                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Cuentas App:                                            â”‚
â”‚  â”œâ”€ POST   /cuentas/login/              [inicio_sesion] â”‚
â”‚  â”‚         â””â”€ AutenticaciÃ³n bÃ¡sica                      â”‚
â”‚  â”‚         â””â”€ Detecta MFA                              â”‚
â”‚  â”‚                                                     â”‚
â”‚  â”œâ”€ POST   /cuentas/register/           [registro]      â”‚
â”‚  â”‚         â””â”€ Crear nueva cuenta                       â”‚
â”‚  â”‚                                                     â”‚
â”‚  â”œâ”€ POST   /cuentas/verificar-mfa/      [verificar_mfa]â”‚
â”‚  â”‚         â””â”€ Verificar cÃ³digo OTP                     â”‚
â”‚  â”‚         â””â”€ Completar login                          â”‚
â”‚  â”‚                                                     â”‚
â”‚  â”œâ”€ GET    /cuentas/habilitar-mfa/      [habilitar_mfa]â”‚
â”‚  â”‚         â””â”€ Mostrar pÃ¡gina de config                 â”‚
â”‚  â”‚                                                     â”‚
â”‚  â””â”€ POST   /cuentas/habilitar-mfa/      [habilitar_mfa]â”‚
â”‚           â””â”€ Guardar cambios MFA                       â”‚
â”‚           â””â”€ Generar QR y secreto                      â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Componentes de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CAPAS DE SEGURIDAD IMPLEMENTADAS                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1ï¸âƒ£  AUTENTICACIÃ“N PRIMARIA                            â”‚
â”‚      â”œâ”€ Email + ContraseÃ±a                             â”‚
â”‚      â”œâ”€ Django make_password() [hashing]               â”‚
â”‚      â””â”€ check_password() [validaciÃ³n]                  â”‚
â”‚                                                         â”‚
â”‚  2ï¸âƒ£  AUTENTICACIÃ“N SECUNDARIA (MFA)                    â”‚
â”‚      â”œâ”€ OTP por Email (6 dÃ­gitos, 10 min)              â”‚
â”‚      â””â”€ TOTP Authenticator (RFC 6238)                  â”‚
â”‚                                                         â”‚
â”‚  3ï¸âƒ£  PROTECCIÃ“N DE SESIÃ“N                              â”‚
â”‚      â”œâ”€ Django Session Framework                       â”‚
â”‚      â”œâ”€ CSRF Protection                                â”‚
â”‚      â””â”€ Cookie segura (httponly)                       â”‚
â”‚                                                         â”‚
â”‚  4ï¸âƒ£  VALIDACIÃ“N DE ENTRADA                             â”‚
â”‚      â”œâ”€ 6 dÃ­gitos exactos para OTP                     â”‚
â”‚      â”œâ”€ Formato email validado                         â”‚
â”‚      â””â”€ Mensajes de error genÃ©ricos                    â”‚
â”‚                                                         â”‚
â”‚  5ï¸âƒ£  RECUPERACIÃ“N                                      â”‚
â”‚      â”œâ”€ Clave secreta de respaldo visible              â”‚
â”‚      â””â”€ Campo backup_codes para futuras mejoras        â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Stack de TecnologÃ­as

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           STACK TECNOLÃ“GICO MFA                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  BACKEND:                                               â”‚
â”‚  â”œâ”€ Python 3.8+                                        â”‚
â”‚  â”œâ”€ Django 3.2+                                        â”‚
â”‚  â”œâ”€ pyotp (OTP/TOTP generation)                       â”‚
â”‚  â””â”€ qrcode[pil] (QR code generation)                  â”‚
â”‚                                                         â”‚
â”‚  FRONTEND:                                              â”‚
â”‚  â”œâ”€ HTML5                                              â”‚
â”‚  â”œâ”€ CSS3 (Tailwind + Custom Gradients)                â”‚
â”‚  â”œâ”€ Font Awesome 6.4.0 (Icons)                        â”‚
â”‚  â”œâ”€ AlpineJS 2.8.2 (Interactivity)                    â”‚
â”‚  â””â”€ Flowbite 3.1.2 (Components)                       â”‚
â”‚                                                         â”‚
â”‚  EMAIL:                                                 â”‚
â”‚  â”œâ”€ Django Email Backend (Console/SMTP)               â”‚
â”‚  â”œâ”€ SMTP: Gmail (production-ready)                    â”‚
â”‚  â””â”€ Format: Plain text + HTML                         â”‚
â”‚                                                         â”‚
â”‚  PERSISTENCIA:                                          â”‚
â”‚  â”œâ”€ SQLite (desarrollo)                               â”‚
â”‚  â”œâ”€ PostgreSQL (producciÃ³n)                           â”‚
â”‚  â””â”€ ORM: Django ORM                                   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Timeline de EjecuciÃ³n

```
Usuario inicia sesiÃ³n
        â”‚
        â–¼ (1) Email + Password
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Validar credencialesâ”‚  ~50ms
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â”€â”€ Â¿MFA? â”€â”€â”€NOâ”€â”€> LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                             â”‚
        YES                                            â”‚
        â”‚                                             â”‚
        â–¼ (2) Generar OTP                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  generate_otp()      â”‚  ~20ms                      â”‚
â”‚  random 6 dÃ­gitos    â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
        â”‚                                             â”‚
        â–¼ (3) Enviar correo                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  send_mail()         â”‚  ~500ms (network)           â”‚
â”‚  SMTP connection     â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
        â”‚                                             â”‚
        â–¼ (4) Guardar sesiÃ³n                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  request.session[]   â”‚  ~10ms                      â”‚
â”‚  DB save             â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
        â”‚                                             â”‚
        â–¼ (5) Redirect                               â”‚
   Verificar MFA                                      â”‚
        â”‚                                             â”‚
        â–¼ (6) Usuario ingresa OTP                    â”‚
        â”‚                                             â”‚
        â–¼ (7) Validar OTP                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  verify_otp()        â”‚  ~15ms                      â”‚
â”‚  Comparar + tiempo   â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
        â”‚                                             â”‚
        â”œâ”€â”€â”€ âœ… VÃ¡lido â”€â”€â”€> LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â””â”€â”€â”€ âŒ InvÃ¡lido â”€â”€> Error + Reintentar
```

---

## 10. Casos de Uso

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           CASOS DE USO DEL SISTEMA MFA                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1. Usuario sin MFA                                     â”‚
â”‚     â†’ Login normal sin codigo adicional                â”‚
â”‚     â†’ RÃ¡pido pero menos seguro                         â”‚
â”‚                                                         â”‚
â”‚  2. Usuario con MFA por Email                          â”‚
â”‚     â†’ Recibe cÃ³digo OTP                                â”‚
â”‚     â†’ Ingresa en 10 minutos                            â”‚
â”‚     â†’ MFA completo âœ…                                  â”‚
â”‚                                                         â”‚
â”‚  3. Usuario con MFA por Authenticator                  â”‚
â”‚     â†’ CÃ³digo cambia cada 30 segundos                  â”‚
â”‚     â†’ MÃ¡xima seguridad                                â”‚
â”‚     â†’ No requiere email                               â”‚
â”‚                                                         â”‚
â”‚  4. Usuario olvida email                              â”‚
â”‚     â†’ Puede usar clave secreta de respaldo            â”‚
â”‚     â†’ Recuperar con cÃ³digo de seguridad               â”‚
â”‚                                                         â”‚
â”‚  5. Usuario quiere desactivar MFA                     â”‚
â”‚     â†’ Acceso a dashboard â†’ Settings                  â”‚
â”‚     â†’ Click desactivar â†’ Confirmado                  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Diagrama creado: âœ… Listo para referencia**
